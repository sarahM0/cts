{"version":3,"sources":["../../../src/common/runtime/standalone.ts"],"names":["DefaultTestFileLoader","Logger","parseQuery","assert","optionEnabled","TestWorker","window","onbeforeunload","haveSomeResults","undefined","runnow","debug","logger","worker","resultsVis","document","getElementById","memoize","fn","value","makeTreeNodeHTML","tree","parentLevel","subtree","makeSubtreeHTML","makeCaseHTML","generateMyHTML","parentElement","div","$","appendTo","generateSubtreeHTML","runSubtree","t","caseResult","updateRenderedResult","name","query","toString","rec","res","record","run","classList","add","caselogs","addClass","hide","casehead","setChecked","makeTreeNodeHeaderHTML","checked","show","casetime","html","appendChild","setAttribute","status","text","timems","toFixed","logs","empty","l","caselog","attr","on","console","log","toJSON","n","makeSubtreeChildrenHTML","children","values","level","subtreeHTML","generateSubtree","header","setChildrenChecked","childFns","Array","from","runMySubtree","setChildChecked","onChange","isLeaf","checkbox","prop","href","lastQueryLevelToExpand","runtext","nodetitle","val","description","append","loader","qs","URLSearchParams","location","search","getAll","length","push","url","protocol","host","pathname","map","q","join","history","replaceState","rootQuery","loadTree","dissolveLevelBoundaries","root","setTreeCheckedRecursively","addEventListener","navigator","clipboard","writeText","asJSON"],"mappings":"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","sourcesContent":["// Implements the standalone test runner (see also: /standalone/index.html).\n\nimport { DefaultTestFileLoader } from '../framework/file_loader.js';\nimport { Logger } from '../framework/logging/logger.js';\nimport { LiveTestCaseResult } from '../framework/logging/result.js';\nimport { parseQuery } from '../framework/query/parseQuery.js';\nimport { TestQueryLevel } from '../framework/query/query.js';\nimport { TestTreeNode, TestSubtree, TestTreeLeaf } from '../framework/tree.js';\nimport { assert } from '../framework/util/util.js';\n\nimport { optionEnabled } from './helper/options.js';\nimport { TestWorker } from './helper/test_worker.js';\n\nwindow.onbeforeunload = () => {\n  // Prompt user before reloading if there are any results\n  return haveSomeResults ? false : undefined;\n};\n\nlet haveSomeResults = false;\n\nconst runnow = optionEnabled('runnow');\nconst debug = optionEnabled('debug');\n\nconst logger = new Logger(debug);\n\nconst worker = optionEnabled('worker') ? new TestWorker(debug) : undefined;\n\nconst resultsVis = document.getElementById('resultsVis')!;\n\ntype SetCheckedRecursively = () => void;\ntype GenerateSubtreeHTML = (parent: HTMLElement) => SetCheckedRecursively;\ntype RunSubtree = () => Promise<void>;\n\ninterface VisualizedSubtree {\n  generateSubtreeHTML: GenerateSubtreeHTML;\n  runSubtree: RunSubtree;\n}\n\n// DOM generation\n\nfunction memoize<T>(fn: () => T): () => T {\n  let value: T | undefined;\n  return () => {\n    if (value === undefined) {\n      value = fn();\n    }\n    return value;\n  };\n}\n\nfunction makeTreeNodeHTML(tree: TestTreeNode, parentLevel: TestQueryLevel): VisualizedSubtree {\n  let subtree: VisualizedSubtree;\n\n  if ('children' in tree) {\n    subtree = makeSubtreeHTML(tree, parentLevel);\n  } else {\n    subtree = makeCaseHTML(tree);\n  }\n\n  const generateMyHTML = (parentElement: HTMLElement) => {\n    const div = $('<div>').appendTo(parentElement)[0];\n    return subtree.generateSubtreeHTML(div);\n  };\n  return { runSubtree: subtree.runSubtree, generateSubtreeHTML: generateMyHTML };\n}\n\nfunction makeCaseHTML(t: TestTreeLeaf): VisualizedSubtree {\n  // Becomes set once the case has been run once.\n  let caseResult: LiveTestCaseResult | undefined;\n\n  // Becomes set once the DOM for this case exists.\n  let updateRenderedResult: (() => void) | undefined;\n\n  const name = t.query.toString();\n  const runSubtree = async () => {\n    haveSomeResults = true;\n    const [rec, res] = logger.record(name);\n    caseResult = res;\n    if (worker) {\n      await worker.run(rec, name);\n    } else {\n      await t.run(rec);\n    }\n\n    if (updateRenderedResult) updateRenderedResult();\n  };\n\n  const generateSubtreeHTML = (div: HTMLElement) => {\n    div.classList.add('testcase');\n\n    const caselogs = $('<div>').addClass('testcaselogs').hide();\n    const [casehead, setChecked] = makeTreeNodeHeaderHTML(t, runSubtree, 2, checked => {\n      checked ? caselogs.show() : caselogs.hide();\n    });\n    const casetime = $('<div>').addClass('testcasetime').html('ms').appendTo(casehead);\n    div.appendChild(casehead);\n    div.appendChild(caselogs[0]);\n\n    updateRenderedResult = () => {\n      if (caseResult) {\n        div.setAttribute('data-status', caseResult.status);\n\n        casetime.text(caseResult.timems.toFixed(4) + ' ms');\n\n        if (caseResult.logs) {\n          caselogs.empty();\n          for (const l of caseResult.logs) {\n            const caselog = $('<div>').addClass('testcaselog').appendTo(caselogs);\n            $('<button>')\n              .addClass('testcaselogbtn')\n              .attr('alt', 'Log stack to console')\n              .attr('title', 'Log stack to console')\n              .appendTo(caselog)\n              .on('click', () => {\n                /* eslint-disable-next-line no-console */\n                console.log(l);\n              });\n            $('<pre>').addClass('testcaselogtext').appendTo(caselog).text(l.toJSON());\n          }\n        }\n      }\n    };\n\n    updateRenderedResult();\n\n    return setChecked;\n  };\n\n  return { runSubtree, generateSubtreeHTML };\n}\n\nfunction makeSubtreeHTML(n: TestSubtree, parentLevel: TestQueryLevel): VisualizedSubtree {\n  const { runSubtree, generateSubtreeHTML } = makeSubtreeChildrenHTML(\n    n.children.values(),\n    n.query.level\n  );\n\n  const generateMyHTML = (div: HTMLElement) => {\n    const subtreeHTML = $('<div>').addClass('subtreechildren');\n    const generateSubtree = memoize(() => generateSubtreeHTML(subtreeHTML[0]));\n\n    // Hide subtree - it's not generated yet.\n    subtreeHTML.hide();\n    const [header, setChecked] = makeTreeNodeHeaderHTML(n, runSubtree, parentLevel, checked => {\n      if (checked) {\n        // Make sure the subtree is generated and then show it.\n        generateSubtree();\n        subtreeHTML.show();\n      } else {\n        subtreeHTML.hide();\n      }\n    });\n\n    div.classList.add('subtree');\n    div.classList.add(['', 'multifile', 'multitest', 'multicase'][n.query.level]);\n    div.appendChild(header);\n    div.appendChild(subtreeHTML[0]);\n\n    return () => {\n      setChecked();\n      const setChildrenChecked = generateSubtree();\n      setChildrenChecked();\n    };\n  };\n\n  return { runSubtree, generateSubtreeHTML: generateMyHTML };\n}\n\nfunction makeSubtreeChildrenHTML(\n  children: Iterable<TestTreeNode>,\n  parentLevel: TestQueryLevel\n): VisualizedSubtree {\n  const childFns = Array.from(children, subtree => makeTreeNodeHTML(subtree, parentLevel));\n\n  const runMySubtree = async () => {\n    for (const { runSubtree } of childFns) {\n      await runSubtree();\n    }\n  };\n  const generateMyHTML = (div: HTMLElement) => {\n    const setChildrenChecked = Array.from(childFns, ({ generateSubtreeHTML }) =>\n      generateSubtreeHTML(div)\n    );\n\n    return () => {\n      for (const setChildChecked of setChildrenChecked) {\n        setChildChecked();\n      }\n    };\n  };\n\n  return { runSubtree: runMySubtree, generateSubtreeHTML: generateMyHTML };\n}\n\nfunction makeTreeNodeHeaderHTML(\n  n: TestTreeNode,\n  runSubtree: RunSubtree,\n  parentLevel: TestQueryLevel,\n  onChange: (checked: boolean) => void\n): [HTMLElement, SetCheckedRecursively] {\n  const isLeaf = 'run' in n;\n  const div = $('<div>').addClass('nodeheader');\n\n  const setChecked = () => {\n    if (checkbox) {\n      checkbox.prop('checked', true); // (does not fire onChange)\n      onChange(true);\n    }\n  };\n\n  let checkbox: JQuery<HTMLElement> | undefined;\n  const href = `?${worker ? 'worker&' : ''}${debug ? 'debug&' : ''}q=${n.query.toString()}`;\n  if (onChange) {\n    checkbox = $('<input>')\n      .attr('type', 'checkbox')\n      .addClass('collapsebtn')\n      .on('change', function (this) {\n        onChange((this as HTMLInputElement).checked);\n      })\n      .attr('alt', 'Expand')\n      .attr('title', 'Expand')\n      .appendTo(div);\n\n    // Expand the shallower parts of the tree at load.\n    // Also expand completely within subtrees that are at the same query level\n    // (e.g. s:f:t,* and s:f:t,t,*).\n    if (n.query.level <= lastQueryLevelToExpand || n.query.level === parentLevel) {\n      setChecked();\n    }\n  }\n  const runtext = isLeaf ? 'Run case' : 'Run subtree';\n  $('<button>')\n    .addClass(isLeaf ? 'leafrun' : 'subtreerun')\n    .attr('alt', runtext)\n    .attr('title', runtext)\n    .on('click', async () => {\n      await runSubtree();\n    })\n    .appendTo(div);\n  $('<a>')\n    .addClass('nodelink')\n    .attr('href', href)\n    .attr('alt', 'Open')\n    .attr('title', 'Open')\n    .appendTo(div);\n  const nodetitle = $('<div>').addClass('nodetitle').appendTo(div);\n  $('<input>')\n    .attr('type', 'text')\n    .prop('readonly', true)\n    .addClass('nodequery')\n    .val(n.query.toString())\n    .appendTo(nodetitle);\n  if ('description' in n && n.description) {\n    nodetitle.append('&nbsp;');\n    $('<pre>') //\n      .addClass('nodedescription')\n      .text(n.description)\n      .appendTo(nodetitle);\n  }\n  return [div[0], setChecked];\n}\n\n// Collapse s:f:t:* or s:f:t:c by default.\nlet lastQueryLevelToExpand: TestQueryLevel = 2;\n\n(async () => {\n  const loader = new DefaultTestFileLoader();\n\n  // TODO: start populating page before waiting for everything to load?\n  const qs = new URLSearchParams(window.location.search).getAll('q');\n  if (qs.length === 0) {\n    qs.push('webgpu:*');\n  }\n\n  // Update the URL bar to match the exact current options.\n  {\n    let url = window.location.protocol + '//' + window.location.host + window.location.pathname;\n    url +=\n      '?' +\n      new URLSearchParams([\n        ['runnow', runnow ? '1' : '0'],\n        ['worker', worker ? '1' : '0'],\n        ['debug', debug ? '1' : '0'],\n      ]).toString() +\n      '&' +\n      qs.map(q => 'q=' + q).join('&');\n    window.history.replaceState(null, '', url);\n  }\n\n  assert(qs.length === 1, 'currently, there must be exactly one ?q=');\n  const rootQuery = parseQuery(qs[0]);\n  if (rootQuery.level > lastQueryLevelToExpand) {\n    lastQueryLevelToExpand = rootQuery.level;\n  }\n  const tree = await loader.loadTree(rootQuery);\n\n  tree.dissolveLevelBoundaries();\n\n  const { runSubtree, generateSubtreeHTML } = makeSubtreeHTML(tree.root, 1);\n  const setTreeCheckedRecursively = generateSubtreeHTML(resultsVis);\n\n  document.getElementById('expandall')!.addEventListener('click', () => {\n    setTreeCheckedRecursively();\n  });\n\n  document.getElementById('copyResultsJSON')!.addEventListener('click', () => {\n    navigator.clipboard.writeText(logger.asJSON(2));\n  });\n\n  if (runnow) {\n    runSubtree();\n  }\n})();\n"],"file":"standalone.js"}