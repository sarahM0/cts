{"version":3,"sources":["../../../../src/webgpu/util/texture/texel_data.spec.ts"],"names":["description","params","poptions","makeTestGroup","assert","kEncodableTextureFormats","kEncodableTextureFormatInfo","GPUTest","kTexelRepresentationInfo","getSingleDataType","getComponentReadbackTraits","g","doTest","t","format","componentData","R","G","B","A","rep","texelData","pack","texture","device","createTexture","size","usage","GPUTextureUsage","COPY_DST","SAMPLED","defaultQueue","writeTexture","bytesPerRow","byteLength","ReadbackTypedArray","shaderType","shader","componentOrder","map","C","i","join","toLowerCase","pipeline","createComputePipeline","computeStage","module","createShaderModule","code","entryPoint","outputBuffer","createBuffer","length","GPUBufferUsage","STORAGE","COPY_SRC","bindGroup","createBindGroup","layout","getBindGroupLayout","entries","binding","resource","createView","buffer","encoder","createCommandEncoder","pass","beginComputePass","setPipeline","setBindGroup","dispatch","endPass","submit","finish","expectContents","c","value","decode","undefined","makeParam","fn","componentInfo","bitLength","test","combine","filter","copyDst","color","expand","max","Math","pow","floor","offset","range"],"mappings":"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","sourcesContent":["export const description = 'Test helpers for texel data produce the expected data in the shader';\n\nimport { params, poptions } from '../../../common/framework/params_builder.js';\nimport { makeTestGroup } from '../../../common/framework/test_group.js';\nimport { assert } from '../../../common/framework/util/util.js';\nimport {\n  kEncodableTextureFormats,\n  kEncodableTextureFormatInfo,\n  EncodableTextureFormat,\n} from '../../capability_info.js';\nimport { GPUTest } from '../../gpu_test.js';\n\nimport {\n  kTexelRepresentationInfo,\n  getSingleDataType,\n  getComponentReadbackTraits,\n} from './texel_data.js';\n\nexport const g = makeTestGroup(GPUTest);\n\nfunction doTest(\n  t: GPUTest & {\n    params: {\n      format: EncodableTextureFormat;\n      R?: number;\n      G?: number;\n      B?: number;\n      A?: number;\n    };\n  }\n) {\n  const { format } = t.params;\n  const componentData = (() => {\n    const { R, G, B, A } = t.params;\n    return { R, G, B, A };\n  })();\n\n  const rep = kTexelRepresentationInfo[format];\n  const texelData = rep.pack(componentData);\n  const texture = t.device.createTexture({\n    format,\n    size: [1, 1, 1],\n    usage: GPUTextureUsage.COPY_DST | GPUTextureUsage.SAMPLED,\n  });\n\n  t.device.defaultQueue.writeTexture(\n    { texture },\n    texelData,\n    {\n      bytesPerRow: texelData.byteLength,\n    },\n    [1]\n  );\n\n  const { ReadbackTypedArray, shaderType } = getComponentReadbackTraits(getSingleDataType(format));\n\n  const shader = `\n  [[group(0), binding(0)]] var<uniform_constant> tex : texture_2d<${shaderType}>;\n\n  [[block]] struct Output {\n    ${rep.componentOrder\n      .map((C, i) => `[[offset(${i * 4})]] result${C} : ${shaderType};`)\n      .join('\\n')}\n  };\n  [[group(0), binding(1)]] var<storage_buffer> output : Output;\n\n  [[stage(compute)]]\n  fn main() -> void {\n      var texel : vec4<${shaderType}> = textureLoad(tex, vec2<i32>(0, 0), 0);\n      ${rep.componentOrder.map(C => `output.result${C} = texel.${C.toLowerCase()};`).join('\\n')}\n      return;\n  }`;\n\n  const pipeline = t.device.createComputePipeline({\n    computeStage: {\n      module: t.device.createShaderModule({\n        code: shader,\n      }),\n      entryPoint: 'main',\n    },\n  });\n\n  const outputBuffer = t.device.createBuffer({\n    size: rep.componentOrder.length * 4,\n    usage: GPUBufferUsage.STORAGE | GPUBufferUsage.COPY_SRC,\n  });\n\n  const bindGroup = t.device.createBindGroup({\n    layout: pipeline.getBindGroupLayout(0),\n    entries: [\n      {\n        binding: 0,\n        resource: texture.createView(),\n      },\n      {\n        binding: 1,\n        resource: {\n          buffer: outputBuffer,\n        },\n      },\n    ],\n  });\n\n  const encoder = t.device.createCommandEncoder();\n  const pass = encoder.beginComputePass();\n  pass.setPipeline(pipeline);\n  pass.setBindGroup(0, bindGroup);\n  pass.dispatch(1);\n  pass.endPass();\n  t.device.defaultQueue.submit([encoder.finish()]);\n\n  t.expectContents(\n    outputBuffer,\n    new ReadbackTypedArray(\n      rep.componentOrder.map(c => {\n        const value = rep.decode(componentData)[c];\n        assert(value !== undefined);\n        return value;\n      })\n    )\n  );\n}\n\n// Make a test parameter by mapping a format and each component to a texel component\n// data value.\nfunction makeParam(\n  format: EncodableTextureFormat,\n  fn: (bitLength: number, index: number) => number\n) {\n  const rep = kTexelRepresentationInfo[format];\n  return {\n    R: rep.componentInfo.R ? fn(rep.componentInfo.R.bitLength, 0) : undefined,\n    G: rep.componentInfo.G ? fn(rep.componentInfo.G.bitLength, 1) : undefined,\n    B: rep.componentInfo.B ? fn(rep.componentInfo.B.bitLength, 2) : undefined,\n    A: rep.componentInfo.A ? fn(rep.componentInfo.A.bitLength, 3) : undefined,\n  };\n}\n\ng.test('unorm_texel_data_in_shader')\n  .params(\n    params()\n      .combine(poptions('format', kEncodableTextureFormats))\n      .filter(({ format }) => {\n        return (\n          kEncodableTextureFormatInfo[format].copyDst &&\n          kEncodableTextureFormatInfo[format].color &&\n          getSingleDataType(format) === 'unorm'\n        );\n      })\n      .expand(({ format }) => {\n        const max = (bitLength: number) => Math.pow(2, bitLength) - 1;\n        return [\n          // Test extrema\n          makeParam(format, () => 0),\n          makeParam(format, bitLength => max(bitLength)),\n\n          // Test a middle value\n          makeParam(format, bitLength => Math.floor(max(bitLength) / 2)),\n\n          // Test mixed values\n          makeParam(format, (bitLength, i) => {\n            const offset = [0.13, 0.63, 0.42, 0.89];\n            return Math.floor(offset[i] * max(bitLength));\n          }),\n        ];\n      })\n  )\n  .fn(doTest);\n\ng.test('snorm_texel_data_in_shader')\n  .params(\n    params()\n      .combine(poptions('format', kEncodableTextureFormats))\n      .filter(({ format }) => {\n        return (\n          kEncodableTextureFormatInfo[format].copyDst &&\n          kEncodableTextureFormatInfo[format].color &&\n          getSingleDataType(format) === 'snorm'\n        );\n      })\n      .expand(({ format }) => {\n        const max = (bitLength: number) => Math.pow(2, bitLength - 1) - 1;\n        return [\n          // Test extrema\n          makeParam(format, () => 0),\n          makeParam(format, bitLength => max(bitLength)),\n          makeParam(format, bitLength => -max(bitLength)),\n          makeParam(format, bitLength => -max(bitLength) - 1),\n\n          // Test a middle value\n          makeParam(format, bitLength => Math.floor(max(bitLength) / 2)),\n\n          // Test mixed values\n          makeParam(format, (bitLength, i) => {\n            const offset = [0.13, 0.63, 0.42, 0.89];\n            const range = 2 * max(bitLength);\n            return -max(bitLength) + Math.floor(offset[i] * range);\n          }),\n        ];\n      })\n  )\n  .fn(doTest);\n\ng.test('uint_texel_data_in_shader')\n  .params(\n    params()\n      .combine(poptions('format', kEncodableTextureFormats))\n      .filter(({ format }) => {\n        return (\n          kEncodableTextureFormatInfo[format].copyDst &&\n          kEncodableTextureFormatInfo[format].color &&\n          getSingleDataType(format) === 'uint'\n        );\n      })\n      .expand(({ format }) => {\n        const max = (bitLength: number) => Math.pow(2, bitLength) - 1;\n        return [\n          // Test extrema\n          makeParam(format, () => 0),\n          makeParam(format, bitLength => max(bitLength)),\n\n          // Test a middle value\n          makeParam(format, bitLength => Math.floor(max(bitLength) / 2)),\n\n          // Test mixed values\n          makeParam(format, (bitLength, i) => {\n            const offset = [0.13, 0.63, 0.42, 0.89];\n            return Math.floor(offset[i] * max(bitLength));\n          }),\n        ];\n      })\n  )\n  .fn(doTest);\n\ng.test('sint_texel_data_in_shader')\n  .params(\n    params()\n      .combine(poptions('format', kEncodableTextureFormats))\n      .filter(({ format }) => {\n        return (\n          kEncodableTextureFormatInfo[format].copyDst &&\n          kEncodableTextureFormatInfo[format].color &&\n          getSingleDataType(format) === 'sint'\n        );\n      })\n      .expand(({ format }) => {\n        const max = (bitLength: number) => Math.pow(2, bitLength - 1) - 1;\n        return [\n          // Test extrema\n          makeParam(format, () => 0),\n          makeParam(format, bitLength => max(bitLength)),\n          makeParam(format, bitLength => -max(bitLength) - 1),\n\n          // Test a middle value\n          makeParam(format, bitLength => Math.floor(max(bitLength) / 2)),\n\n          // Test mixed values\n          makeParam(format, (bitLength, i) => {\n            const offset = [0.13, 0.63, 0.42, 0.89];\n            const range = 2 * max(bitLength);\n            return -max(bitLength) + Math.floor(offset[i] * range);\n          }),\n        ];\n      })\n  )\n  .fn(doTest);\n\ng.test('float_texel_data_in_shader')\n  .params(\n    params()\n      .combine(poptions('format', kEncodableTextureFormats))\n      .filter(({ format }) => {\n        return (\n          kEncodableTextureFormatInfo[format].copyDst &&\n          kEncodableTextureFormatInfo[format].color &&\n          getSingleDataType(format) === 'float'\n        );\n      })\n      .expand(({ format }) => {\n        return [\n          // Test extrema\n          makeParam(format, () => 0),\n\n          // TODO: Test NaN, Infinity, -Infinity\n\n          // Test some values\n          makeParam(format, () => 0.1199951171875),\n          makeParam(format, () => 1.4072265625),\n          makeParam(format, () => 24928),\n          makeParam(format, () => -0.1319580078125),\n          makeParam(format, () => -323.25),\n          makeParam(format, () => -7440),\n\n          // Test mixed values\n          makeParam(format, (bitLength, i) => {\n            return [24896, -0.1319580078125, -323.25, -234.375][i];\n          }),\n        ];\n      })\n  )\n  .fn(doTest);\n\ng.test('ufloat_texel_data_in_shader')\n  .params(\n    params()\n      .combine(poptions('format', kEncodableTextureFormats))\n      .filter(({ format }) => {\n        return (\n          kEncodableTextureFormatInfo[format].copyDst &&\n          kEncodableTextureFormatInfo[format].color &&\n          getSingleDataType(format) === 'ufloat'\n        );\n      })\n      .expand(({ format }) => {\n        return [\n          // Test extrema\n          makeParam(format, () => 0),\n\n          // TODO: Test NaN, Infinity\n\n          // Test some values\n          makeParam(format, () => 0.119140625),\n          makeParam(format, () => 1.40625),\n          makeParam(format, () => 24896),\n\n          // Test scattered mixed values\n          makeParam(format, (bitLength, i) => {\n            return [24896, 1.40625, 0.119140625, 0.23095703125][i];\n          }),\n\n          // Test mixed values that are close in magnitude.\n          makeParam(format, (bitLength, i) => {\n            return [0.1337890625, 0.17919921875, 0.119140625, 0.125][i];\n          }),\n        ];\n      })\n  )\n  .fn(doTest);\n"],"file":"texel_data.spec.js"}